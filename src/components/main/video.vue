<template>
    <div>
        <re></re>
        <div class="img">
        <video-player class="video-player vjs-custom-skin"
            ref="videoPlayer"
            :playsinline="true"
            :options="playerOptions">
        </video-player>
        </div>
        <van-divider :style="{ borderColor: '#1989fa'}"/>
        <div class="infob">
           <van-skeleton avatar title :row="3" :loading="false" >
               <div class="avatar">
                   <van-image width="40" radius="5px" :src="info_list.portraits"/>
                   <span>{{info_list.mv_publisher}}</span><br>
                   <small>{{info_list.time|dateformat}}</small>
                   <p v-html="info_list.mv_introduce"></p>
                </div>
            </van-skeleton>
            <van-divider :style="{ borderColor: '#1989fa'}"/>
            <div class="like">
                <span @click="like">
                    <svg v-if="!flag" t="1578311173354" class="icon" viewBox="0 0 1053 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="26976" width="24" height="24"><path d="M349.4007553 105.23526594s-48.96347813 228.14023219-54.9606825 303.63928594c144.42582937-85.43962594 179.09460094-48.88132406 54.9606825-303.63928594zM711.20471061 105.23526594s48.96347813 228.14023219 54.96068251 303.63928594c-144.42582937-85.43962594-179.09460094-48.88132406-54.9606825-303.63928594zM526.44151874 540.40228438h1.72522313v-0.08215407c-0.65722781 0.08215312-1.31445562 0.08215312-1.72522313 0.08215406z" fill="#707070" p-id="26977"></path><path d="M281.95274249 522.5749775c0-63.58679906 51.51023625-115.09703437 115.09703531-115.09703437 63.58679906 0 115.09703437 51.51023625 115.09703438 115.09703437 0 5.99720437-0.49292063 11.8301025-1.31445562 17.58084656 6.16151156 0 18.48453469 0.08215312 21.4420603 0.16430625l0.24646032-258.78348281S63.9995428 348.90250719 165.62340562 779.14031655c0 0 67.44801281-131.69203875 133.33510875-196.42898717-10.84426031-17.41653937-17.00577187-38.03706469-17.00577188-60.13635188zM534.2461003 540.40228438h-1.72522312v-0.08215407c0.65722781 0.08215312 1.2323025 0.08215312 1.72522312 0.08215406z" fill="#707070" p-id="26978"></path><path d="M778.65272249 522.5749775c0-63.58679906-51.51023625-115.09703437-115.09703437-115.09703437-63.58679906 0-115.09703437 51.51023625-115.09703438 115.09703437 0 5.99720437 0.49292063 11.8301025 1.31445563 17.58084656-6.16151156 0-18.48453469 0.08215312-21.44206032 0.16430625l-0.24646031-258.78348281s468.52133437 67.36585875 366.89747156 497.60366905c0 0-67.44801281-131.69203875-133.33510968-196.42898718 10.84426031-17.41653937 17.00577187-38.03706469 17.00577187-60.13635187z" fill="#707070" p-id="26979" data-spm-anchor-id="a313x.7781069.0.i25" class=""></path><path d="M530.30273249 992c-34.25800406 0-154.11994125-3.77906063-260.42655187-51.83884969C157.16159624 889.14383469 97.60031905 804.93651125 97.60031905 696.57606219c0-75.00613312 16.34854406-146.06889938 48.71701688-211.13446031 7.47596719-15.11624156 25.79619469-21.27775312 40.91243718-13.80178594 15.11624156 7.47596719 21.27775312 25.79619469 13.801785 40.91243625-28.0964925 56.6037525-42.30904594 118.4653275-42.309045 184.02381 0 83.71440281 45.92379938 146.9725875 136.3747875 187.88502375 95.13373781 43.04842688 204.15141375 46.41672 235.28758594 46.41672 31.13617125 0 140.15384812-3.36829313 235.287585-46.41672 90.53314219-40.99458937 136.3747875-104.17062094 136.37478844-187.88502375 0-69.33754313-18.89530219-139.41446719-54.71422219-202.59049781-8.29750219-14.70547406-3.12183281-33.27216187 11.50148813-41.56966407 14.70547406-8.29750219 33.27216187-3.12183281 41.56966405 11.50148813 40.91243625 72.37722188 62.60095687 152.80548469 62.60095688 232.65867375 0 108.278295-59.56127813 192.48561937-172.27586156 243.50293406-106.22445844 48.14194313-226.16854875 51.92100375-260.42655281 51.92100375zM425.06411624 312.097745L405.26512593 254.34384406c40.58382281-13.88393906 82.6464075-20.94913875 125.03760656-20.94913968 40.50166875 0 80.75687719 6.490125 119.77978405 19.22391656l-18.9774553 58.00036125c-32.86139438-10.76210719-66.70863094-16.18423687-100.80232875-16.18423688-35.57245969 0-70.98061219 5.91505125-105.23861625 17.66299969z" fill="#707070" p-id="26980"></path><path d="M157.73667093 570.96338094c-1.72522313 0-3.36829313-0.16430719-5.09351625-0.4107675-16.59500437-2.79321844-27.85003219-18.56668781-25.05681282-35.16169219 0.65722781-4.02552094 17.17007906-100.72017469 51.42808219-209.9021578C226.49913936 174.490655 283.51365936 77.30307969 348.49706718 36.63710469c7.31166-4.60059562 16.26639001-5.83289719 24.56389219-3.45044719 8.29750219 2.38245094 15.19839469 8.133195 19.05960937 15.85562344 54.46776188 110.66074688 79.27811438 212.77753031 80.26395562 217.04951156 3.94336781 16.43069719-6.16151156 32.86139438-22.59220875 36.80476219-16.43069719 3.94336781-32.86139438-6.16151156-36.80476125-22.59220875-0.24646031-0.90368812-19.22391563-79.03165406-59.39697094-169.48264313-41.73397125 42.63765937-81.49625906 122.08008094-116.32933781 232.98728813-33.02570156 105.15646313-49.29209156 200.7009675-49.45639874 201.68680968-2.54675813 14.86978125-15.44485594 25.46758125-30.06817594 25.46758032zM903.1152553 570.96338094c-14.62332094 0-27.52141781-10.51564594-30.06817594-25.46758032-0.24646031-1.2323025-16.59500437-97.26972844-49.70286-202.34403749-34.75092469-110.57859281-74.43105844-189.77455406-116.0007225-232.33006032-40.25520844 90.69744937-59.15051062 168.57895406-59.39697093 169.48264313-3.94336781 16.43069719-20.374065 26.53557657-36.80476219 22.59220875-16.43069719-3.94336781-26.53557657-20.374065-22.59220875-36.80476219 0.98584219-4.27198125 25.79619469-106.38876469 80.26395656-217.04951156 3.77906063-7.7224275 10.76210719-13.55532563 19.05960844-15.85562344 8.29750219-2.38245094 17.25223219-1.06799531 24.56389219 3.45044719 64.90125469 40.66597594 121.91577375 137.85355031 169.40049 288.85165876 34.34015719 109.18198406 50.77085437 205.79448375 51.42808219 209.9021578 2.79321844 16.59500437-8.37965531 32.36847375-25.05681282 35.16169219-1.64306999 0.24646031-3.36829313 0.4107675-5.09351625 0.4107675zM549.85526249 658.45684438h-38.283525c-24.72819937 0-40.17305531 26.78203687-27.76787812 48.14194312l19.14176249 19.71683719c13.71963187 13.14455812 41.24105062 13.14455812 55.61791032 0l19.1417625-19.71683719c12.32302313-21.35990625-3.12183281-48.14194313-27.85003219-48.14194313zM397.37839124 636.11109594c-16.84146469 0-30.47894343-13.63747875-30.47894344-30.47894344v-69.17323593c0-16.84146469 13.63747875-30.47894343 30.47894344-30.47894344s30.47894343 13.63747875 30.47894344 30.47894344v69.17323593c0.08215312 16.75931156-13.63747875 30.47894343-30.47894344 30.47894344zM663.22707374 636.11109594c-16.84146469 0-30.47894343-13.63747875-30.47894344-30.47894344v-69.17323593c0-16.84146469 13.63747875-30.47894343 30.47894344-30.47894344s30.47894343 13.63747875 30.47894438 30.47894344v69.17323593c0 16.75931156-13.63747875 30.47894343-30.47894438 30.47894344z" fill="#707070" p-id="26981"></path><path d="M481.91432905 809.53710594h-0.57507468c-38.11921781-0.49292063-61.53296156-54.79637531-64.07971876-60.95788688-3.20398594-7.80458156 0.49292063-16.6771575 8.29750219-19.88114344 7.80458156-3.20398594 16.6771575 0.49292063 19.88114344 8.29750219 6.98304656 16.92361781 23.41374375 41.98043156 36.31184063 42.06258469h0.08215406c9.85841813 0 22.67436187-15.8556225 34.42231031-42.47335219 3.36829313-7.7224275 12.40517625-11.17287375 20.12760469-7.80458156s11.17287375 12.40517625 7.80458156 20.12760469c-17.90946 40.74812906-38.283525 60.62927344-62.27234344 60.6292725z" fill="#707070" p-id="26982"></path><path d="M578.69113688 809.53710594c-23.90666437 0-44.28072937-19.79899031-62.35449658-60.6292725-3.36829313-7.7224275 0.08215312-16.6771575 7.80458063-20.12760469 7.7224275-3.36829313 16.6771575 0.08215312 20.12760469 7.80458156 11.74794844 26.61772969 24.64604625 42.47335219 34.42231124 42.47335219h0.08215312c13.47317156-0.16430719 30.31463625-27.52141781 36.31184064-42.06258469 3.20398594-7.80458156 12.15871594-11.50148812 19.88114437-8.29750219 7.80458156 3.20398594 11.50148812 12.15871594 8.29750219 19.88114344-2.54675813 6.16151156-25.96050188 60.46496625-64.07971969 60.95788688h-0.49292063z" fill="#707070" p-id="26983"></path></svg>

                    <svg v-if="flag" t="1578311173354" class="icon" viewBox="0 0 1053 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="26976" width="24" height="24"><path d="M349.4007553 105.23526594s-48.96347813 228.14023219-54.9606825 303.63928594c144.42582937-85.43962594 179.09460094-48.88132406 54.9606825-303.63928594zM711.20471061 105.23526594s48.96347813 228.14023219 54.96068251 303.63928594c-144.42582937-85.43962594-179.09460094-48.88132406-54.9606825-303.63928594zM526.44151874 540.40228438h1.72522313v-0.08215407c-0.65722781 0.08215312-1.31445562 0.08215312-1.72522313 0.08215406z" fill="#d81e06" p-id="26977"></path><path d="M281.95274249 522.5749775c0-63.58679906 51.51023625-115.09703437 115.09703531-115.09703437 63.58679906 0 115.09703437 51.51023625 115.09703438 115.09703437 0 5.99720437-0.49292063 11.8301025-1.31445562 17.58084656 6.16151156 0 18.48453469 0.08215312 21.4420603 0.16430625l0.24646032-258.78348281S63.9995428 348.90250719 165.62340562 779.14031655c0 0 67.44801281-131.69203875 133.33510875-196.42898717-10.84426031-17.41653937-17.00577187-38.03706469-17.00577188-60.13635188zM534.2461003 540.40228438h-1.72522312v-0.08215407c0.65722781 0.08215312 1.2323025 0.08215312 1.72522312 0.08215406z" fill="#d81e06" p-id="26978"></path><path d="M778.65272249 522.5749775c0-63.58679906-51.51023625-115.09703437-115.09703437-115.09703437-63.58679906 0-115.09703437 51.51023625-115.09703438 115.09703437 0 5.99720437 0.49292063 11.8301025 1.31445563 17.58084656-6.16151156 0-18.48453469 0.08215312-21.44206032 0.16430625l-0.24646031-258.78348281s468.52133437 67.36585875 366.89747156 497.60366905c0 0-67.44801281-131.69203875-133.33510968-196.42898718 10.84426031-17.41653937 17.00577187-38.03706469 17.00577187-60.13635187z" fill="#d81e06" p-id="26979" data-spm-anchor-id="a313x.7781069.0.i25" class=""></path><path d="M530.30273249 992c-34.25800406 0-154.11994125-3.77906063-260.42655187-51.83884969C157.16159624 889.14383469 97.60031905 804.93651125 97.60031905 696.57606219c0-75.00613312 16.34854406-146.06889938 48.71701688-211.13446031 7.47596719-15.11624156 25.79619469-21.27775312 40.91243718-13.80178594 15.11624156 7.47596719 21.27775312 25.79619469 13.801785 40.91243625-28.0964925 56.6037525-42.30904594 118.4653275-42.309045 184.02381 0 83.71440281 45.92379938 146.9725875 136.3747875 187.88502375 95.13373781 43.04842688 204.15141375 46.41672 235.28758594 46.41672 31.13617125 0 140.15384812-3.36829313 235.287585-46.41672 90.53314219-40.99458937 136.3747875-104.17062094 136.37478844-187.88502375 0-69.33754313-18.89530219-139.41446719-54.71422219-202.59049781-8.29750219-14.70547406-3.12183281-33.27216187 11.50148813-41.56966407 14.70547406-8.29750219 33.27216187-3.12183281 41.56966405 11.50148813 40.91243625 72.37722188 62.60095687 152.80548469 62.60095688 232.65867375 0 108.278295-59.56127813 192.48561937-172.27586156 243.50293406-106.22445844 48.14194313-226.16854875 51.92100375-260.42655281 51.92100375zM425.06411624 312.097745L405.26512593 254.34384406c40.58382281-13.88393906 82.6464075-20.94913875 125.03760656-20.94913968 40.50166875 0 80.75687719 6.490125 119.77978405 19.22391656l-18.9774553 58.00036125c-32.86139438-10.76210719-66.70863094-16.18423687-100.80232875-16.18423688-35.57245969 0-70.98061219 5.91505125-105.23861625 17.66299969z" fill="#d81e06" p-id="26980"></path><path d="M157.73667093 570.96338094c-1.72522313 0-3.36829313-0.16430719-5.09351625-0.4107675-16.59500437-2.79321844-27.85003219-18.56668781-25.05681282-35.16169219 0.65722781-4.02552094 17.17007906-100.72017469 51.42808219-209.9021578C226.49913936 174.490655 283.51365936 77.30307969 348.49706718 36.63710469c7.31166-4.60059562 16.26639001-5.83289719 24.56389219-3.45044719 8.29750219 2.38245094 15.19839469 8.133195 19.05960937 15.85562344 54.46776188 110.66074688 79.27811438 212.77753031 80.26395562 217.04951156 3.94336781 16.43069719-6.16151156 32.86139438-22.59220875 36.80476219-16.43069719 3.94336781-32.86139438-6.16151156-36.80476125-22.59220875-0.24646031-0.90368812-19.22391563-79.03165406-59.39697094-169.48264313-41.73397125 42.63765937-81.49625906 122.08008094-116.32933781 232.98728813-33.02570156 105.15646313-49.29209156 200.7009675-49.45639874 201.68680968-2.54675813 14.86978125-15.44485594 25.46758125-30.06817594 25.46758032zM903.1152553 570.96338094c-14.62332094 0-27.52141781-10.51564594-30.06817594-25.46758032-0.24646031-1.2323025-16.59500437-97.26972844-49.70286-202.34403749-34.75092469-110.57859281-74.43105844-189.77455406-116.0007225-232.33006032-40.25520844 90.69744937-59.15051062 168.57895406-59.39697093 169.48264313-3.94336781 16.43069719-20.374065 26.53557657-36.80476219 22.59220875-16.43069719-3.94336781-26.53557657-20.374065-22.59220875-36.80476219 0.98584219-4.27198125 25.79619469-106.38876469 80.26395656-217.04951156 3.77906063-7.7224275 10.76210719-13.55532563 19.05960844-15.85562344 8.29750219-2.38245094 17.25223219-1.06799531 24.56389219 3.45044719 64.90125469 40.66597594 121.91577375 137.85355031 169.40049 288.85165876 34.34015719 109.18198406 50.77085437 205.79448375 51.42808219 209.9021578 2.79321844 16.59500437-8.37965531 32.36847375-25.05681282 35.16169219-1.64306999 0.24646031-3.36829313 0.4107675-5.09351625 0.4107675zM549.85526249 658.45684438h-38.283525c-24.72819937 0-40.17305531 26.78203687-27.76787812 48.14194312l19.14176249 19.71683719c13.71963187 13.14455812 41.24105062 13.14455812 55.61791032 0l19.1417625-19.71683719c12.32302313-21.35990625-3.12183281-48.14194313-27.85003219-48.14194313zM397.37839124 636.11109594c-16.84146469 0-30.47894343-13.63747875-30.47894344-30.47894344v-69.17323593c0-16.84146469 13.63747875-30.47894343 30.47894344-30.47894344s30.47894343 13.63747875 30.47894344 30.47894344v69.17323593c0.08215312 16.75931156-13.63747875 30.47894343-30.47894344 30.47894344zM663.22707374 636.11109594c-16.84146469 0-30.47894343-13.63747875-30.47894344-30.47894344v-69.17323593c0-16.84146469 13.63747875-30.47894343 30.47894344-30.47894344s30.47894343 13.63747875 30.47894438 30.47894344v69.17323593c0 16.75931156-13.63747875 30.47894343-30.47894438 30.47894344z" fill="#d81e06" p-id="26981"></path><path d="M481.91432905 809.53710594h-0.57507468c-38.11921781-0.49292063-61.53296156-54.79637531-64.07971876-60.95788688-3.20398594-7.80458156 0.49292063-16.6771575 8.29750219-19.88114344 7.80458156-3.20398594 16.6771575 0.49292063 19.88114344 8.29750219 6.98304656 16.92361781 23.41374375 41.98043156 36.31184063 42.06258469h0.08215406c9.85841813 0 22.67436187-15.8556225 34.42231031-42.47335219 3.36829313-7.7224275 12.40517625-11.17287375 20.12760469-7.80458156s11.17287375 12.40517625 7.80458156 20.12760469c-17.90946 40.74812906-38.283525 60.62927344-62.27234344 60.6292725z" fill="#d81e06" p-id="26982"></path><path d="M578.69113688 809.53710594c-23.90666437 0-44.28072937-19.79899031-62.35449658-60.6292725-3.36829313-7.7224275 0.08215312-16.6771575 7.80458063-20.12760469 7.7224275-3.36829313 16.6771575 0.08215312 20.12760469 7.80458156 11.74794844 26.61772969 24.64604625 42.47335219 34.42231124 42.47335219h0.08215312c13.47317156-0.16430719 30.31463625-27.52141781 36.31184064-42.06258469 3.20398594-7.80458156 12.15871594-11.50148812 19.88114437-8.29750219 7.80458156 3.20398594 11.50148812 12.15871594 8.29750219 19.88114344-2.54675813 6.16151156-25.96050188 60.46496625-64.07971969 60.95788688h-0.49292063z" fill="#d81e06" p-id="26983"></path></svg>
                    <span>{{like_new}}</span>
                </span>
                <span>{{info_list.title}}</span>
            </div>
        </div>
        <van-divider :style="{ borderColor: '#1989fa'}"/>
        <deletes :keys='info_list.Identification' :id="id" tag='video' :alllist='alllist'></deletes>
        <comment :id='id' tag='mv' />
    </div>
</template>
<script>
import comment from '../tool/comment.vue';
import deletes from '../tool/delete.vue';
import re from '../tool/return.vue';
import { Toast } from 'vant';
export default {
    data() {
        return {
            info_list:{},
            id:this.$route.params.id,
            flag:false,
            playerOptions: {
                //播放速度
                playbackRates: [0.5, 1.0, 1.5, 2.0], 
                //如果true,浏览器准备好时开始回放。
                autoplay: false, 
                // 默认情况下将会消除任何音频。
                muted: false, 
                // 导致视频一结束就重新开始。
                loop: false, 
                // 建议浏览器在<video>加载元素后是否应该开始下载视频数据。auto浏览器选择最佳行为,立即开始加载视频（如果浏览器支持）
                preload: 'auto', 
                language: 'zh-CN',
                    // 将播放器置于流畅模式，并在计算播放器的动态大小时使用该值。值应该代表一个比例 - 用冒号分隔的两个数字（例如"16:9"或"4:3"）
                aspectRatio: '16:9',
                    // 当true时，Video.js player将拥有流体大小。换句话说，它将按比例缩放以适应其容器。
                fluid: true,
                sources: [{
                    //类型
                    type: "video/mp4",
                    //url地址
                    src: "" 
                }],
                //你的封面地址
                poster: '', 
                    //允许覆盖Video.js无法播放媒体源时显示的默认信息。
                notSupportedMessage: '此视频暂无法播放，请稍后再试',
                controlBar: {
                    timeDivider: true,
                    durationDisplay: true,
                    remainingTimeDisplay: false,
                    //全屏按钮
                    fullscreenToggle: true  
                }
            },
            like_old:0,
            like_new:0,
            alllist:[{img_url:null},{img_url:null}],
        }
    },
    created() {
        this.getimages()
    },
    beforeDestroy() {
        this.getlike()
    },
    methods: {
        getimages(){
            // /getvideodetail/:id
             this.$axios.get(`${this.$store.state.url}video/getvideodetail/${this.id}`).then((reslut)=>{
                if(reslut.data.code == 0){
                    this.info_list = reslut.data.msg[0];
                    this.like_new = reslut.data.msg[0].likes;
                    this.like_old = reslut.data.msg[0].likes;
                    this.alllist[0].img_url = reslut.data.msg[0].img_url;
                    this.alllist[1].img_url = reslut.data.msg[0].mv_url;
                    this.playerOptions.sources[0].src = this.info_list.mv_url;
                }else if(reslut.data.code == 1){
                    Toast({
                        message: '访问数据时,我们迷路了',
                        icon: 'close'
                    });
                }
            }).catch((err)=>{
                 Toast({
                    message: '访问数据时,它已经远走高飞了',
                    icon: 'question-o'
                });
            })
        },
        like(){
             if(this.flag == true){
                this.like_new --;
                this.flag = false;
            }else{
                this.like_new ++;
                this.flag = true;
                //发生请求
            }
            
        },
        getlike(){
            if (this.$store.state.user == '') {
                return Toast({
                    message: '未登录不可点赞    Do not log in to thumb up',
                    icon: 'close'
                });
            }else{
                if (this.like_new == this.like_old) {
                    return
                }
                this.$axios({
                    method:'get',
                    url:`${this.$store.state.url}/subsidiary/like`,
                    params:{
                        tag:'video',
                        id:this.id,
                        num:this.like_new,
                    }
                }).then((res)=>{
                    if(res.data.code == 0){
                    }else if(res.data.code == 1){
                        Toast({
                            message: '点赞失败  Failed to like',
                            icon: 'close'
                        });
                    }
                }).catch((err)=>{
                    Toast({
                        message: '服务器故障 Server down',
                        icon: 'question-o'
                    });
                })
        
        
        
            }
        },
    },
    components:{
        re,
        comment,
        deletes
    }
}
</script>
<style lang="less">
@font-face {
    font-family: fa;
    src: url('../../assets/ttf/aa.ttf');
}
.img{
    .van-image{
        margin: 15px 10px 0 10px;
    }
}
.infob{
    background-color: #f4f8ff;
    .avatar{
        margin: 5px 20px;
        white-space: pre-line;
        span{
            margin-left: 10px;
            font-size: 19px;
            font-weight: 700;
            text-align: center;
            line-height: 30px
        }
        p{
            font-size: 16px;
            color: #371744;
            text-align: center;
        }
    }
    .like{
        display: flex;
        justify-content: space-between;
        :nth-child(1){
            margin-left: 8%;
            width: 30px;
        }
        :nth-child(2){
            margin-right: 8%;
            font-size: 20px;
            font-weight: 800;
            font-family: fa;
        }
    }
}
</style>